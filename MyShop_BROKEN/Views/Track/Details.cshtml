@model MyShop.Models.Checkout
@{
    ViewData["Title"] = $"Order #{Model.OrderId} Details";
}

<style>
    .order-details-container {
        max-width: 1200px;
        margin: 0 auto;
    }

    .order-header-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .status-indicator {
        display: inline-flex;
        align-items: center;
        background-color: rgba(255,255,255,0.2);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        margin-top: 1rem;
    }

    .detail-section {
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

        .detail-section h5 {
            border-bottom: 2px solid #f8f9fa;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

    .order-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        border: 1px solid #f8f9fa;
        border-radius: 8px;
        margin-bottom: 0.5rem;
        background-color: #f8f9fa;
    }

        .order-item:hover {
            background-color: #e9ecef;
        }

    .tracking-card {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        border: 2px solid #2196f3;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .tracking-number {
        font-family: monospace;
        font-size: 1.2rem;
        letter-spacing: 2px;
        background-color: white;
        padding: 0.5rem 1rem;
        border-radius: 5px;
        border: 2px dashed #2196f3;
        display: inline-block;
        margin: 0.5rem 0;
    }

    .action-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .map-placeholder {
        background-color: #f8f9fa;
        border-radius: 10px;
        height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #6c757d;
        border: 2px dashed #dee2e6;
    }

    .contact-support {
        background-color: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 10px;
        padding: 1.5rem;
        margin-top: 2rem;
    }
</style>

<div class="order-details-container">
    <!-- Order Header -->
    <div class="order-header-card">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="display-6">Order #@Model.OrderId</h1>
                <p class="mb-0">
                    <i class="bi bi-calendar me-2"></i>
                    Placed on @Model.OrderDate.ToString("dd MMMM yyyy")
                </p>
                <div class="status-indicator">
                    <i class="bi bi-truck me-2"></i>
                    <strong>Status: </strong> @Model.OrderStatus
                </div>
            </div>
            <div class="col-md-4 text-md-end">
                <h2 class="display-5">R @Model.Total.ToString("0.00")</h2>
                <p class="mb-0">@Model.OrderItems.Sum(oi => oi.Quantity) item(s)</p>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Left Column -->
        <div class="col-lg-8">
            <!-- Tracking Information -->
            @if (!string.IsNullOrEmpty(Model.TrackingNumber))
            {
                <div class="tracking-card">
                    <h5><i class="bi bi-geo-alt me-2"></i>Tracking Information</h5>
                    <p class="mb-2">
                        <strong>Tracking Number:</strong><br>
                        <span class="tracking-number">@Model.TrackingNumber</span>
                    </p>
                    <p class="mb-1">
                        <strong>Shipping Carrier:</strong> @Model.ShippingCarrier<br>
                        <strong>Shipping Service:</strong> @Model.ShippingService
                    </p>
                    @if (Model.EstimatedDelivery.HasValue)
                    {
                        <p class="mb-0">
                            <strong>Estimated Delivery:</strong>
                            @Model.EstimatedDelivery.Value.ToString("dd MMMM yyyy")
                        </p>
                    }
                    @if (Model.ActualDelivery.HasValue)
                    {
                        <p class="mb-0 text-success">
                            <strong>Delivered:</strong>
                            @Model.ActualDelivery.Value.ToString("dd MMMM yyyy hh:mm tt")
                        </p>
                    }
                </div>
            }

            <!-- Order Items -->
            <div class="detail-section">
                <h5><i class="bi bi-box-seam me-2"></i>Order Items</h5>
                @foreach (var item in Model.OrderItems)
                {
                    <div class="order-item">
                        <div class="flex-grow-1">
                            <h6 class="mb-1">@item.ProductName</h6>
                            <p class="text-muted mb-0 small">Product ID: @item.ProductId</p>
                        </div>
                        <div class="text-end">
                            <div class="mb-1">R @item.Total.ToString("0.00")</div>
                            <div class="text-muted small">@item.Quantity x R @item.Price.ToString("0.00")</div>
                        </div>
                    </div>
                }
            </div>

            <!-- Shipping Address -->
            <div class="detail-section">
                <h5><i class="bi bi-truck me-2"></i>Shipping Address</h5>
                <p class="mb-1">
                    <strong>@Model.FirstName @Model.LastName</strong><br>
                    @Model.Address<br>
                    @Model.City, @Model.PostalCode<br>
                    @Model.Country
                </p>
                <p class="mb-0">
                    <i class="bi bi-envelope me-2"></i>@Model.Email<br>
                    <i class="bi bi-phone me-2"></i>@Model.Phone
                </p>
            </div>

            <!-- Delivery Map (Placeholder) -->
            <div class="detail-section">
                <h5><i class="bi bi-map me-2"></i>Delivery Location</h5>
                <div class="map-placeholder">
                    <div class="text-center">
                        <i class="bi bi-geo" style="font-size: 3rem;"></i>
                        <p class="mt-2">Delivery map would appear here</p>
                        <small class="text-muted">Location: @Model.City, @Model.Country</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="col-lg-4">
            <!-- Order Summary -->
            <div class="detail-section">
                <h5><i class="bi bi-receipt me-2"></i>Order Summary</h5>
                <div class="order-detail-row">
                    <span>Subtotal</span>
                    <span>R @Model.Subtotal.ToString("0.00")</span>
                </div>
                <div class="order-detail-row">
                    <span>Tax (15%)</span>
                    <span>R @Model.Tax.ToString("0.00")</span>
                </div>
                <div class="order-detail-row">
                    <span>Shipping</span>
                    <span>R @Model.Shipping.ToString("0.00")</span>
                </div>
                <hr>
                <div class="order-detail-row">
                    <strong>Total</strong>
                    <strong class="text-primary">R @Model.Total.ToString("0.00")</strong>
                </div>
            </div>

            <!-- Payment Information -->
            <div class="detail-section">
                <h5><i class="bi bi-credit-card me-2"></i>Payment Information</h5>
                <p class="mb-1">
                    <strong>Method:</strong> @Model.PaymentMethod<br>
                    <strong>Status:</strong> <span class="badge bg-success">Paid</span>
                </p>
                @if (Model.PaymentMethod == "Credit Card" && !string.IsNullOrEmpty(Model.CardNumber))
                {
                    <p class="mb-0">
                        <strong>Card:</strong> **** **** **** @Model.CardNumber.Substring(Math.Max(0, Model.CardNumber.Length - 4))
                    </p>
                }
            </div>

            <!-- Action Buttons -->
            <div class="detail-section">
                <h5><i class="bi bi-lightning me-2"></i>Quick Actions</h5>
                <div class="action-buttons">
                    <a asp-action="Subscribe" asp-route-orderId="@Model.OrderId" asp-route-email="@Model.Email"
                       class="btn btn-outline-success">
                        <i class="bi bi-bell me-1"></i>Get Updates
                    </a>
                    <button class="btn btn-outline-primary" onclick="window.print()">
                        <i class="bi bi-printer me-1"></i>Print Invoice
                    </button>
                    @if (!string.IsNullOrEmpty(Model.TrackingNumber))
                    {
                        <a href="https://www.dpd.co.uk/tracking/trackingSearch.do?search.searchType=0&search.parcelNumber=@Model.TrackingNumber"
                           target="_blank" class="btn btn-outline-info">
                            <i class="bi bi-box-arrow-up-right me-1"></i>Track on Carrier Site
                        </a>
                    }
                    <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">
                        <i class="bi bi-house me-1"></i>Continue Shopping
                    </a>
                </div>
            </div>

            <!-- Contact Support -->
            <div class="contact-support">
                <h6><i class="bi bi-headset me-2"></i>Need Help?</h6>
                <p class="mb-2">Having issues with your order?</p>
                <div class="action-buttons">
                    <a href="mailto:support@myshop.com?subject=Order%20@Model.OrderId"
                       class="btn btn-outline-danger btn-sm">
                        <i class="bi bi-envelope me-1"></i>Email Support
                    </a>
                    <a href="tel:+27123456789" class="btn btn-outline-danger btn-sm">
                        <i class="bi bi-telephone me-1"></i>Call Support
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Auto-refresh tracking every 30 seconds
        setInterval(() => {
            if (window.location.pathname.includes('/Track/Details/')) {
                // You could implement live tracking updates here
                console.log('Checking for tracking updates...');
            }
        }, 30000);
    </script>
}