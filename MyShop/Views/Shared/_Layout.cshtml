<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - My Shop</title>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/MyShop.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/interactive.css" asp-append-version="true" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
    @await RenderSectionAsync("Styles", required: false)
</head>
<body>
    <!-- Loader Container (From Universe.io)-->
    <div id="globalLoader" class="loader-overlay" style="display: none;">
        <div class="loader">
            <div class="truckWrapper">
                <div class="truckBody">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         fill="none"
                         viewBox="0 0 198 93"
                         class="trucksvg">
                        <path stroke-width="3"
                              stroke="#282828"
                              fill="#F83D3D"
                              d="M135 22.5H177.264C178.295 22.5 179.22 23.133 179.594 24.0939L192.33 56.8443C192.442 57.1332 192.5 57.4404 192.5 57.7504V89C192.5 90.3807 191.381 91.5 190 91.5H135C133.619 91.5 132.5 90.3807 132.5 89V25C132.5 23.6193 133.619 22.5 135 22.5Z"></path>
                        <path stroke-width="3"
                              stroke="#282828"
                              fill="#7D7C7C"
                              d="M146 33.5H181.741C182.779 33.5 183.709 34.1415 184.078 35.112L190.538 52.112C191.16 53.748 189.951 55.5 188.201 55.5H146C144.619 55.5 143.5 54.3807 143.5 53V36C143.5 34.6193 144.619 33.5 146 33.5Z"></path>
                        <path stroke-width="2"
                              stroke="#282828"
                              fill="#282828"
                              d="M150 65C150 65.39 149.763 65.8656 149.127 66.2893C148.499 66.7083 147.573 67 146.5 67C145.427 67 144.501 66.7083 143.873 66.2893C143.237 65.8656 143 65.39 143 65C143 64.61 143.237 64.1344 143.873 63.7107C144.501 63.2917 145.427 63 146.5 63C147.573 63 148.499 63.2917 149.127 63.7107C149.763 64.1344 150 64.61 150 65Z"></path>
                        <rect stroke-width="2"
                              stroke="#282828"
                              fill="#FFFCAB"
                              rx="1"
                              height="7"
                              width="5"
                              y="63"
                              x="187"></rect>
                        <rect stroke-width="2"
                              stroke="#282828"
                              fill="#282828"
                              rx="1"
                              height="11"
                              width="4"
                              y="81"
                              x="193"></rect>
                        <rect stroke-width="3"
                              stroke="#282828"
                              fill="#DFDFDF"
                              rx="2.5"
                              height="90"
                              width="121"
                              y="1.5"
                              x="6.5"></rect>
                        <rect stroke-width="2"
                              stroke="#282828"
                              fill="#DFDFDF"
                              rx="2"
                              height="4"
                              width="6"
                              y="84"
                              x="1"></rect>
                    </svg>
                </div>
                <div class="truckTires">
                    <svg xmlns="http://www.w3.org/2000/svg"
                         fill="none"
                         viewBox="0 0 30 30"
                         class="tiresvg">
                        <circle stroke-width="3"
                                stroke="#282828"
                                fill="#282828"
                                r="13.5"
                                cy="15"
                                cx="15"></circle>
                        <circle fill="#DFDFDF" r="7" cy="15" cx="15"></circle>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg"
                         fill="none"
                         viewBox="0 0 30 30"
                         class="tiresvg">
                        <circle stroke-width="3"
                                stroke="#282828"
                                fill="#282828"
                                r="13.5"
                                cy="15"
                                cx="15"></circle>
                        <circle fill="#DFDFDF" r="7" cy="15" cx="15"></circle>
                    </svg>
                </div>
                <div class="road"></div>

                <svg xml:space="preserve"
                     viewBox="0 0 453.459 453.459"
                     xmlns:xlink="http://www.w3.org/1999/xlink"
                     xmlns="http://www.w3.org/2000/svg"
                     id="Capa_1"
                     version="1.1"
                     fill="#000000"
                     class="lampPost">
                <path d="M252.882,0c-37.781,0-68.686,29.953-70.245,67.358h-6.917v8.954c-26.109,2.163-45.463,10.011-45.463,19.366h9.993
                        c-1.65,5.146-2.507,10.54-2.507,16.017c0,28.956,23.558,52.514,52.514,52.514c28.956,0,52.514-23.558,52.514-52.514
                        c0-5.478-0.856-10.872-2.506-16.017h9.992c0-9.354-19.352-17.204-45.463-19.366v-8.954h-6.149C200.189,38.779,223.924,16,252.882,16
                        c29.952,0,54.32,24.368,54.32,54.32c0,28.774-11.078,37.009-25.105,47.437c-17.444,12.968-37.216,27.667-37.216,78.884v113.914
                        h-0.797c-5.068,0-9.174,4.108-9.174,9.177c0,2.844,1.293,5.383,3.321,7.066c-3.432,27.933-26.851,95.744-8.226,115.459v11.202h45.75
                        v-11.202c18.625-19.715-4.794-87.527-8.227-115.459c2.029-1.683,3.322-4.223,3.322-7.066c0-5.068-4.107-9.177-9.176-9.177h-0.795
                        V196.641c0-43.174,14.942-54.283,30.762-66.043c14.793-10.997,31.559-23.461,31.559-60.277C323.202,31.545,291.656,0,252.882,0z
                        M232.77,111.694c0,23.442-19.071,42.514-42.514,42.514c-23.442,0-42.514-19.072-42.514-42.514c0-5.531,1.078-10.957,3.141-16.017
                        h78.747C231.693,100.736,232.77,106.162,232.77,111.694z"></path>
                </svg>
            </div>
        </div>
    </div>

    <!-- Modern Header -->
    <header class="sticky-top">
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
            <div class="container">
                <a class="navbar-brand fw-bold fs-3" asp-area="" asp-controller="Home" asp-action="Index">
                    <span class="text-primary">My </span> Shop
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarContent">
                    <ul class="navbar-nav ms-auto">
                     
                        @if (User.IsInRole("Admin"))
                        {
                            
                            <li class="nav-item">
                                <a class="nav-link" asp-controller="OrderManager" asp-action="Index">
                                    <i class="bi bi-truck"></i> Manage Orders
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" asp-controller="Product" asp-action="Create">
                                    <i class="bi bi-box">Create Products</i> 
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" asp-controller="Category" asp-action="Index">
                                    <i class="bi bi-tag">Category Manager</i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" asp-controller="Account" asp-action="Register">
                                    <i class="bi bi-people">User Registration</i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" asp-controller="UserManagement" asp-action="Index">
                                    <i class="bi bi-people"></i> User Management
                                </a>
                            </li>
                        }
                        else
                        {
                            <li class="nav-item">
                                <a class="nav-link" asp-controller="Home" asp-action="Index">
                                    <i class="bi bi-house"></i> Home
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link position-relative" asp-controller="Cart" asp-action="Index">
                                    <i class="bi bi-cart"></i> Cart
                                    <!-- Cart Notification Badge -->
                                    <span id="cartBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                                        0
                                    </span>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link position-relative" asp-controller="Track" asp-action="Index">
                                    <i class="bi bi-truck"></i> Track order
                                    <!-- Cart Notification Badge -->
                                    <span id="cartBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display: none;">
                                        0
                                    </span>
                                </a>
                            </li>
                        }
                      
                        <ul class="navbar-nav ml-auto">
                            @if (User.Identity.IsAuthenticated)
                            {
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        @User.Identity.Name
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                                        <a class="dropdown-item" href="#"><i class="bi bi-person"></i> Profile</a>
                                        <a class="dropdown-item" href="#"><i class="bi bi-gear"></i> Settings</a>
                                        <div class="dropdown-divider"></div>
                                        <form method="post" asp-controller="Account" asp-action="Logout">
                                            <button type="submit" class="dropdown-item"><i class="bi bi-box-arrow-right"></i> Logout</button>
                                        </form>
                                    </div>
                                </li>
                            }
                            else
                            {
                                <li class="nav-item">
                                    <a class="nav-link" asp-controller="Account" asp-action="Login"><i class="bi bi-box-arrow-in-right"></i> Login</a>
                                </li>
                            }
                        </ul>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main>
        @RenderBody()
    </main>

    <!-- Modern Footer -->
    <footer class="bg-dark text-white pt-5 pb-4">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 mb-4">
                    <h5 class="text-uppercase fw-bold mb-4">Sphesihle's Shop</h5>
                    <p>Your one-stop shop for quality products at affordable prices. We're committed to bringing you the best shopping experience.</p>
                    <div class="social-icons mt-3">
                        <a href="https://www.facebook.com/" class="text-white me-3"><i class="bi bi-facebook"></i></a>       
                        <a href="https://www.instagram.com/" class="text-white me-3"><i class="bi bi-instagram"></i></a>
                        <a href="https://www.linkedin.com/in/sphesihleshezi1017/" class="text-white"><i class="bi bi-linkedin"></i></a>
                    </div>
                </div>
                <div class="col-lg-2 col-md-6 mb-4">
                    <h5 class="text-uppercase fw-bold mb-4">Shop</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a asp-controller="Product" asp-action="Index" class="text-white">All Products</a></li>
                        <li class="mb-2"><a asp-controller ="Product" asp-action="Index" class="text-white">New Arrivals</a></li>
                        <li class="mb-2"><a asp-controller="Product" asp-action="Index" class="text-white">Featured</a></li>
                        <li class="mb-2"><a asp-controller="Product" asp-action="Index" class="text-white">Discounts</a></li>
                    </ul>
                </div>
                <div class="col-lg-2 col-md-6 mb-4">
                    <h5 class="text-uppercase fw-bold mb-4">Help</h5>
                    <ul class="list-unstyled">
                        <li class="mb-2"><a href="#" class="text-white">FAQ</a></li>
                        <li class="mb-2"><a asp-controller="Track" asp-action="Index" class="text-white">Shipping</a></li>
                        <li class="mb-2"><a asp-controller="Track" asp-action="Index" class="text-white">Returns</a></li>
                        <li class="mb-2"><a href="https://www.linkedin.com/in/sphesihleshezi1017/" class="text-white">Contact Us</a></li>
                    </ul>
                </div>

          
            </div>
            <hr class="my-4">
            <div class="row align-items-center">
                <div class="col-md-6 text-center text-md-start">
                    &copy; Developer: Sphesihle Shezi

                </div>
            </div>
        </div>
    </footer>

    <!-- Back to Top Button -->
    <a href="#" class="btn btn-primary btn-lg back-to-top" role="button">
        <i class="bi bi-arrow-up"></i>
    </a>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <!-- Cart Notification Script -->
    <script>
              document.addEventListener('DOMContentLoaded', function() {
            const loader = document.getElementById('globalLoader');

            // Show loader immediately
            loader.style.display = 'flex';

            // Hide loader after 5 seconds
            setTimeout(function() {
                loader.classList.add('loader-hidden');

                // Remove from DOM after animation completes
                setTimeout(function() {
                    loader.style.display = 'none';
                }, 500); // Match this with CSS transition time
            }, 2000); // 2 seconds
        });

        // Optional: Also hide loader when page is fully loaded (before 5 seconds)
        window.addEventListener('load', function() {
            const loader = document.getElementById('globalLoader');

            // Check if loader is still visible
            if (loader.style.display === 'flex') {
                // Wait at least 2 seconds minimum for user experience
                setTimeout(function() {
                    loader.classList.add('loader-hidden');
                    setTimeout(function() {
                        loader.style.display = 'none';
                    }, 500);
                }, 2000); // Minimum 2 seconds even if page loads faster
            }
        });
                // Optional: Show loader on link clicks for page transitions
        document.addEventListener('click', function(e) {
            // Check if the clicked element is an internal link
            if (e.target.tagName === 'A' || e.target.closest('a')) {
                const link = e.target.tagName === 'A' ? e.target : e.target.closest('a');
                const href = link.getAttribute('href');

                // Check if it's not an external link, anchor, or javascript link
                if (href &&
                    !href.startsWith('http') &&
                    !href.startsWith('#') &&
                    !href.startsWith('javascript:') &&
                    !link.hasAttribute('data-bs-toggle')) {

                    // Show loader
                    const loader = document.getElementById('globalLoader');
                    if (loader) {
                        loader.style.display = 'flex';
                        loader.classList.remove('loader-hidden');
                    }
                }
            }
        });
        // Cart management functions
        const cartManager = {
            // Get cart from localStorage
            getCart: function() {
                const cart = localStorage.getItem('shoppingCart');
                return cart ? JSON.parse(cart) : [];
            },

            // Save cart to localStorage
            saveCart: function(cart) {
                localStorage.setItem('shoppingCart', JSON.stringify(cart));
                this.updateCartBadge();
            },

            // Add item to cart
            addToCart: function(productId, productName, price, quantity = 1) {
                let cart = this.getCart();
                const existingItem = cart.find(item => item.productId === productId);

                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    cart.push({
                        productId: productId,
                        productName: productName,
                        price: price,
                        quantity: quantity,
                        addedAt: new Date().toISOString()
                    });
                }

                this.saveCart(cart);
                return cart;
            },

            // Remove item from cart
            removeFromCart: function(productId) {
                let cart = this.getCart();
                cart = cart.filter(item => item.productId !== productId);
                this.saveCart(cart);
                return cart;
            },

            // Update item quantity
            updateQuantity: function(productId, quantity) {
                let cart = this.getCart();
                const item = cart.find(item => item.productId === productId);

                if (item) {
                    if (quantity <= 0) {
                        return this.removeFromCart(productId);
                    }
                    item.quantity = quantity;
                }

                this.saveCart(cart);
                return cart;
            },

            // Clear entire cart
            clearCart: function() {
                localStorage.removeItem('shoppingCart');
                this.updateCartBadge();
            },

            // Get total items count
            getTotalItems: function() {
                const cart = this.getCart();
                return cart.reduce((total, item) => total + item.quantity, 0);
            },

            // Get total price
            getTotalPrice: function() {
                const cart = this.getCart();
                return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            },

            // Update cart badge in navbar
            updateCartBadge: function() {
                const totalItems = this.getTotalItems();
                const cartBadge = document.getElementById('cartBadge');

                if (cartBadge) {
                    if (totalItems > 0) {
                        cartBadge.textContent = totalItems;
                        cartBadge.style.display = 'block';

                        // Add animation
                        cartBadge.classList.add('animate__animated', 'animate__bounce');
                        setTimeout(() => {
                            cartBadge.classList.remove('animate__bounce');
                        }, 1000);
                    } else {
                        cartBadge.style.display = 'none';
                    }
                }
            },

            // Show add to cart notification
            showCartNotification: function(productName) {
                // Create toast notification
                const toastContainer = document.createElement('div');
                toastContainer.className = 'position-fixed top-0 end-0 p-3';
                toastContainer.style.zIndex = '9999';
                toastContainer.innerHTML = `
                    <div class="toast show" role="alert">
                        <div class="toast-header bg-success text-white">
                            <i class="bi bi-check-circle me-2"></i>
                            <strong class="me-auto">Added to Cart!</strong>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
                        </div>
                        <div class="toast-body">
                            <strong>${productName}</strong> has been added to your cart.
                            <div class="mt-2">
                                <a href="/Cart" class="btn btn-sm btn-outline-success">View Cart</a>
                                <button class="btn btn-sm btn-success" onclick="cartManager.continueShopping()">Continue Shopping</button>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(toastContainer);

                // Auto remove after 5 seconds
                setTimeout(() => {
                    toastContainer.remove();
                }, 5000);
            },

            // Continue shopping (close notification)
            continueShopping: function() {
                document.querySelectorAll('.toast').forEach(toast => {
                    toast.remove();
                });
            }
        };

        // Initialize cart badge on page load
        document.addEventListener('DOMContentLoaded', function() {
            cartManager.updateCartBadge();

            // Add event listeners to all "Add to Cart" buttons
            document.querySelectorAll('.add-to-cart').forEach(button => {
                button.addEventListener('click', function() {
                    const productId = this.getAttribute('data-product-id');
                    const productName = this.closest('.card').querySelector('.card-title').textContent;
                    const priceText = this.closest('.card').querySelector('.text-primary').textContent;
                    const price = parseFloat(priceText.replace('R', '').trim());

                    // Add to cart
                    cartManager.addToCart(productId, productName, price, 1);

                    // Show notification
                    cartManager.showCartNotification(productName);

                    // Optional: Add button animation
                    this.innerHTML = '<i class="bi bi-check me-1"></i>Added!';
                    this.classList.remove('btn-success');
                    this.classList.add('btn-secondary');
                    this.disabled = true;

                    // Reset button after 2 seconds
                    setTimeout(() => {
                        this.innerHTML = '<i class="bi bi-cart-plus me-1"></i>Add to Cart';
                        this.classList.remove('btn-secondary');
                        this.classList.add('btn-success');
                        this.disabled = false;
                    }, 2000);
                });
            });

            // Optional: Add CSS for animations
            if (!document.querySelector('#cartStyles')) {
                const style = document.createElement('style');
                style.id = 'cartStyles';
                style.textContent = `
                    /* Cart badge styles */
                    #cartBadge {
                        font-size: 0.7rem;
                        padding: 0.25em 0.6em;
                        min-width: 1.5em;
                    }

                    /* Toast notification styles */
                    .toast {
                        min-width: 300px;
                        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                        border: none;
                    }

                    /* Cart link hover effect */
                    .nav-link[href*="Cart"]:hover #cartBadge {
                        transform: scale(1.1);
                        transition: transform 0.2s ease;
                    }

                    /* Pulse animation for cart badge */
                   @@keyframes pulse {
                        0% { transform: scale(1); }
                        50% { transform: scale(1.2); }
                        100% { transform: scale(1); }
                    }

                    .cart-pulse {
                        animation: pulse 0.5s ease-in-out;
                    }
                `;
                document.head.appendChild(style);
            }
        });

        // Make cartManager available globally
        window.cartManager = cartManager;
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>